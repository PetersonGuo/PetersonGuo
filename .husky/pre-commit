#!/bin/sh

RESUME_TEX="public/Peterson_Guo_Resume.tex"

if git diff --cached --name-only | grep -q "$RESUME_TEX"; then
  # Build PDF first (with personal contact info in .tex)
  echo "üìù Building resume PDF..."
  RESUME_PUBLIC_EMAIL="peterson.guo@uwaterloo.ca $|$" node scripts/buildResume.js

  # Then sanitize the .tex file for commit
  echo "üìù Sanitizing contact info in $RESUME_TEX..."
  sed -i '' 's/\\providecommand{\\ResumePhone}{[^}]*}/\\providecommand{\\ResumePhone}{}/g' "$RESUME_TEX"
  sed -i '' 's/\\providecommand{\\ResumeEmail}{[^}]*}/\\providecommand{\\ResumeEmail}{}/g' "$RESUME_TEX"

  # Stage both: PDF with contact, .tex without contact
  git add "$RESUME_TEX" public/Peterson_Guo_Resume.pdf

  echo "‚úì Resume built and contact info sanitized"
fi
